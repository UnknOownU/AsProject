{% extends 'base.html.twig' %}
{% block body %}
    <div class="container mt-5">
        <h1 class="text-center mb-4">Étape 3: Choisir le type de contrôle technique</h1>

        {{ form_start(form) }}
            <div class="row">
                {% for child in form.controlType %}
                    <div class="col-md-6 mb-3">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body position-relative p-4">
                                {{ form_widget(child, {'attr': {'class': 'form-check-input d-none'}}) }}
                                <label class="form-check-label w-100 btn btn-outline-warning text-white py-3 d-flex align-items-center" for="{{ child.vars.id }}" style="cursor: pointer;">
                                    <span class="mr-3 d-flex align-items-center justify-content-center" style="min-width: 50px;">
                                        {% if child.vars.value == 'CTP' %}
                                            <i class="fas fa-clipboard-check fa-2x"></i>
                                        {% elseif child.vars.value == 'CV Banc' %}
                                            <i class="fas fa-sync-alt fa-2x"></i>
                                        {% elseif child.vars.value == 'CV Vis + Bc 4p' %}
                                            <i class="fas fa-eye fa-2x"></i>
                                        {% elseif child.vars.value == 'CC Pol' %}
                                            <i class="fas fa-cloud-smog fa-2x"></i>
                                        {% elseif child.vars.value == 'Vol Comp' %}
                                            <i class="fas fa-tasks fa-2x"></i>
                                        {% elseif child.vars.value == 'Vol Part' %}
                                            <i class="fas fa-check-square fa-2x"></i>
                                        {% endif %}
                                    </span>
                                    <div class="text-center flex-grow-1">
                                        <strong>{{ child.vars.label|trans }}</strong>
                                        <small class="d-block text-white-50 mt-1 description">
                                            {% if child.vars.value == 'CTP' %}
                                                Contrôle technique réglementaire
                                            {% elseif child.vars.value == 'CV Banc' %}
                                                Contre-visite banc
                                            {% elseif child.vars.value == 'CV Vis + Bc 4p' %}
                                                CV Visuelle + Bancs 4 points
                                            {% elseif child.vars.value == 'CC Pol' %}
                                                Visite complémentaire pollution
                                            {% elseif child.vars.value == 'Vol Comp' %}
                                                Contrôle volontaire complet
                                            {% elseif child.vars.value == 'Vol Part' %}
                                                Contrôle volontaire partiel
                                            {% endif %}
                                        </small>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-warning btn-lg text-black">Suivant</button>
            </div>
        {{ form_end(form) }}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.form-check-label');
            const selectedControlType = localStorage.getItem('selectedControlType'); // Récupérer l'ancienne sélection

            buttons.forEach(button => {
                const input = button.previousElementSibling;

                // Si l'élément était précédemment sélectionné, on le réactive
                if (input.value === selectedControlType) {
                    button.classList.add('active');
                    button.style.backgroundColor = 'rgba(255, 215, 0, 0.3)'; // Jaune doux avec moins d'opacité
                    button.style.color = 'black';
                    input.checked = true;
                }

                button.addEventListener('click', function() {
                    // Désactiver toutes les autres options
                    buttons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.style.backgroundColor = '';
                        btn.style.color = 'white';
                        btn.previousElementSibling.checked = false;
                    });

                    // Activer l'option sélectionnée
                    button.classList.add('active');
                    button.style.backgroundColor = 'rgba(255, 215, 0, 0.3)';
                    button.style.color = 'black';
                    input.checked = true;

                    // Stocker la valeur sélectionnée dans localStorage
                    localStorage.setItem('selectedControlType', input.value);
                });
            });
        });
    </script>
{% endblock %}
