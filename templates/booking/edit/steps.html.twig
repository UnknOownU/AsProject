{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Modifier votre rendez-vous</h1> {# Changer le titre pour indiquer qu'il s'agit d'une modification #}

    {{ form_start(form, {'attr': {'id': 'appointmentForm'}}) }}

    <!-- Étape 1: Choisir le type de véhicule -->
    <div id="step1" class="step">
        <h2 class="text-center mb-4">Étape 1: Choisir le type de véhicule</h2>
        <div class="row">
            {% for child in form.carType %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100 option-card vehicle-option" data-name="{{ child.vars.full_name }}">
                        <div class="card-body text-center">
                            {{ form_widget(child, {'attr': {'class': 'form-check-input d-none'}}) }}
                            <label class="form-check-label btn w-100 p-3 d-flex flex-column align-items-center" for="{{ child.vars.id }}">
                                <span class="d-block mb-2">
                                    {% if child.vars.value == 'Véhicule particulier' %}
                                        <i class="fas fa-car fa-2x"></i>
                                    {% elseif child.vars.value == 'Véhicule particulier 4x4' %}
                                        <i class="fas fa-truck-pickup fa-2x"></i>
                                    {% elseif child.vars.value == 'Utilitaire' %}
                                        <i class="fas fa-truck fa-2x"></i>
                                    {% elseif child.vars.value == 'Utilitaire 4x4' %}
                                        <i class="fas fa-truck-monster fa-2x"></i>
                                    {% elseif child.vars.value == 'Véhicule spécifique' %}
                                        <i class="fas fa-trailer fa-2x"></i>
                                    {% elseif child.vars.value == 'Camping car' %}
                                        <i class="fas fa-rv fa-2x"></i>
                                    {% elseif child.vars.value == 'Véhicule de collection' %}
                                        <i class="fas fa-car-side fa-2x"></i>
                                    {% elseif child.vars.value == 'Utilitaire caisse grand volume' %}
                                        <i class="fas fa-shuttle-van fa-2x"></i>
                                    {% endif %}
                                </span>
                                {{ child.vars.label|trans }}
                            </label>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <button type="button" class="btn btn-warning btn-lg" onclick="nextStep(2)">Suivant</button>
        </div>
    </div>

    <!-- Étape 2: Choisir le type de carburant -->
    <div id="step2" class="step" style="display: none;">
        <h2 class="text-center mb-4">Étape 2: Choisir le type de carburant</h2>
        <div class="row">
            {% for child in form.fuelType %}
                <div class="col-md-4 mb-3">
                    <div class="card h-100 option-card fuel-option" data-name="{{ child.vars.full_name }}">
                        <div class="card-body text-center">
                            {{ form_widget(child, {'attr': {'class': 'form-check-input d-none'}}) }}
                            <label class="form-check-label btn w-100 p-3 d-flex flex-column align-items-center" for="{{ child.vars.id }}">
                                <span class="d-block mb-2">
                                    {% if child.vars.value == 'Essence' %}
                                        <i class="fas fa-gas-pump fa-2x"></i>
                                    {% elseif child.vars.value == 'Diesel' %}
                                        <i class="fas fa-oil-can fa-2x"></i>
                                    {% elseif child.vars.value == 'GPL' %}
                                        <i class="fas fa-burn fa-2x"></i>
                                    {% elseif child.vars.value == 'Hybride / Electricité' %}
                                        <i class="fas fa-car-battery fa-2x"></i>
                                    {% endif %}
                                </span>
                                {{ child.vars.label|trans }}
                            </label>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <button type="button" class="btn btn-secondary btn-lg" onclick="previousStep(1)">Précédent</button>
            <button type="button" class="btn btn-warning btn-lg" onclick="nextStep(3)">Suivant</button>
        </div>
    </div>

    <!-- Étape 3: Choisir le type de contrôle technique -->
    <div id="step3" class="step" style="display: none;">
        <h2 class="text-center mb-4">Étape 3: Choisir le type de contrôle technique</h2>
        <div class="row">
            {% for child in form.controlType %}
                <div class="col-md-6 mb-3">
                    <div class="card h-100 option-card control-option" data-name="{{ child.vars.full_name }}">
                        <div class="card-body text-center">
                            {{ form_widget(child, {'attr': {'class': 'form-check-input d-none'}}) }}
                            <label class="form-check-label btn w-100 p-3 d-flex flex-column align-items-center" for="{{ child.vars.id }}" style="cursor: pointer;">
                                <span class="d-block mb-2">
                                    {% if child.vars.value == 'CTP' %}
                                        <i class="fas fa-clipboard-check fa-2x"></i>
                                    {% elseif child.vars.value == 'CV Banc' %}
                                        <i class="fas fa-sync-alt fa-2x"></i>
                                    {% elseif child.vars.value == 'CV Vis + Bc 4p' %}
                                        <i class="fas fa-eye fa-2x"></i>
                                    {% elseif child.vars.value == 'CC Pol' %}
                                        <i class="fas fa-cloud-smog fa-2x"></i>
                                    {% elseif child.vars.value == 'Vol Comp' %}
                                        <i class="fas fa-tasks fa-2x"></i>
                                    {% elseif child.vars.value == 'Vol Part' %}
                                        <i class="fas fa-check-square fa-2x"></i>
                                    {% endif %}
                                </span>
                                <div class="text-center flex-grow-1">
                                    <strong>{{ child.vars.label|trans }}</strong>
                                    <small class="d-block text-white-50 mt-1 description">
                                        {% if child.vars.value == 'CTP' %}
                                            Contrôle technique réglementaire
                                        {% elseif child.vars.value == 'CV Banc' %}
                                            Contre-visite banc
                                        {% elseif child.vars.value == 'CV Vis + Bc 4p' %}
                                            CV Visuelle + Bancs 4 points
                                        {% elseif child.vars.value == 'CC Pol' %}
                                            Visite complémentaire pollution
                                        {% elseif child.vars.value == 'Vol Comp' %}
                                            Contrôle volontaire complet
                                        {% elseif child.vars.value == 'Vol Part' %}
                                            Contrôle volontaire partiel
                                        {% endif %}
                                    </small>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="text-center mt-4">
            <button type="button" class="btn btn-secondary btn-lg" onclick="previousStep(2)">Précédent</button>
            <button type="button" class="btn btn-warning btn-lg" onclick="nextStep(4)">Suivant</button>
        </div>
    </div>

    <!-- Étape 4: Informations personnelles -->
    <div id="step4" class="step" style="display: none;">
        <h2 class="text-center mb-4">Étape 4: Vos informations</h2>
        <div class="row">
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.firstname) }}
                    {{ form_widget(form.firstname, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.lastname) }}
                    {{ form_widget(form.lastname, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.email) }}
                    {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.phone) }}
                    {{ form_widget(form.phone, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.carBrand) }}
                    {{ form_widget(form.carBrand, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.carModel) }}
                    {{ form_widget(form.carModel, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="form-group">
                    {{ form_label(form.licensePlate) }}
                    {{ form_widget(form.licensePlate, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button type="button" class="btn btn-secondary btn-lg" onclick="previousStep(3)">Précédent</button>
            <button type="submit" class="btn btn-warning btn-lg text-black">Confirmer et passer à la sélection du créneau horaire</button>
        </div>
    </div>

    {{ form_end(form) }}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    let currentStep = 1;

    function showStep(step) {
        document.querySelectorAll('.step').forEach(function (el) {
            el.style.display = 'none';
        });
        const stepElement = document.getElementById('step' + step);
        if (stepElement) {
            stepElement.style.display = 'block';
        }
    }

    function handleOptionClick(event) {
        const card = event.currentTarget;
        const step = parseInt(card.closest('.step').id.replace('step', ''));
        const dataName = card.getAttribute('data-name');
        const formInput = document.querySelector(`#appointmentForm input[name="${dataName}"]`);

        if (!formInput) {
            console.error('Input field not found for:', dataName);
            return;
        }

        console.log(`Handling click for step ${step} on card with data-name ${dataName}`);

        // Deselect all cards in the current step
        document.querySelectorAll('#step' + step + ' .option-card').forEach(function (opt) {
            opt.classList.remove('selected');
        });

        // Select the clicked card
        card.classList.add('selected');
        formInput.checked = true;

        // Remove focus from input to avoid accessibility issues
        formInput.blur();
    }

    document.querySelectorAll('.option-card').forEach(function (el) {
        el.addEventListener('click', handleOptionClick);
    });

    window.nextStep = function (step) {
        console.log(`Moving to step ${step}`);
        showStep(step);
    };

    window.previousStep = function (step) {
        console.log(`Moving to step ${step}`);
        showStep(step);
    };

    // Initial display
    showStep(1);
});
</script>

<style>
/* Styles généraux pour les cartes d'option */
.card {
    transition: all 0.3s ease;
}

/* Apparence des options sélectionnées */
.option-card.selected {
    background-color: #fff7e6; /* Jaune doux */
    border-color: #FFD700; /* Jaune pour la bordure */
    color: #000 !important; /* Texte en noir avec priorité */
    opacity: 0.9; /* Légère opacité */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Ombre douce */
}

/* Apparence des options au survol */
.option-card:hover {
    background-color: #fff7e6; /* Jaune doux */
    border-color: #FFD700; /* Jaune pour la bordure */
    color: #000 !important; /* Texte en noir avec priorité */
    opacity: 0.9; /* Légère opacité */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* Ombre plus marquée */
}

/* Styles spécifiques pour le texte des cartes dans les étapes 1, 2 et 3 */
#step1 .card-body, 
#step2 .card-body, 
#step3 .card-body {
    color: #000 !important; /* Texte en noir avec priorité */
}

/* Assure que les étiquettes à l'intérieur des cartes gardent la couleur noire */
.option-card label {
    color: #000 !important; /* Texte en noir avec priorité */
}

/* Spécifique au texte de description dans le step3 */
#step3 .description {
    color: #666; /* Gris plus clair pour le texte de description */
}
</style>

{% endblock %}
